<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Robolectric</title>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-58882116-1"]);
  _gaq.push(["_trackPageview"]);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
    <link href="../images/favicon.ico" rel="icon" type="image/ico" />
    <link href="../stylesheets/application-4badc936.css" rel="stylesheet" type="text/css" />
    <script src="../javascripts/application-da39a3ee.js" type="text/javascript"></script>
</head>

<body>
    <div id="wrapper">
        <div id="sidebar">
            <a href="/"><img class="logo" src="../images/robolectric-stacked-3f7ad42c.png" /></a>
<ul class='nav nav-stacked'><li class='nav-header'>Setup</li><li class='nav-item'><a href='/getting-started/'>Getting Started</a></li><li class='nav-item'><a href='/writing-a-test/'>Writing Your First Test</a></li></ul><ul class='nav nav-stacked'><li class='nav-header'>User Guide</li><li class='nav-item'><a href='/configuring/'>Configuring Robolectric</a></li><li class='nav-item'><a href='/activity-lifecycle/'>Driving the Activity Lifecycle</a></li><li class='nav-item'><a href='/using-add-on-modules/'>Using Add-On Modules</a></li><li class='nav-item'><a href='/using-libraries/'>Using Library Resources</a></li><li class='nav-item'><a href='/using-qualifiers/'>Using Qualified Resources</a></li></ul><ul class='nav nav-stacked'><li class='nav-header'>Customizing</li><li class='nav-item'><a href='/extending/'>Extending Robolectric</a></li><li class='nav-item'><a href='/custom-shadows/'>Creating Custom Shadows</a></li><li class='nav-item'><a href='/custom-test-runner/'>Customizing the Test Runner</a></li></ul><ul class='nav nav-stacked'><li class='nav-header'>Contributing</li><li class='nav-item'><a href='/contributing/'>Contributor Guidelines</a></li></ul>

            <ul class="nav nav-stacked">
    <li class="nav-header">Resources</li>
    <li class="nav-item">
        <a href='http://groups.google.com/group/robolectric'>Mailing List</a>
    </li>
    <li class="nav-item">
        <a href='/javadoc/2.4/index.html'>Robolectric 2.4 Javadocs</a>
    </li>
    <li class="nav-item">
        <a href='/javadoc/3.0/index.html'>Robolectric 3.0 Javadocs</a>
    </li>
    <li class="nav-item">
        <a href='/javadoc/3.1/index.html'>Robolectric 3.1 Javadocs</a>
    </li>
</ul>

        </div>

        <div id="content">
            <h1>Creating Custom Shadows</h1>

<p>Custom shadows are a Robolectric feature that allows you to make targeted changes in the way Android functions under
test.  This could be anything from capturing simply that a method was called, to inserting code that interacts with
test objects, to doing nothing at all.</p>

<p>Custom shadows allow you to include shadow functionality in only some of your test code, as opposed to adding or
modifying a Shadow in Robolectric source.  They also allow your shadow to refer to domain specific context, like
domain objects in your test classes.</p>

<h2>Writing a Custom Shadow</h2>

<p>Custom shadows are structured much the same as normal shadow classes.  They must include the <code>@Implements(AndroidClassName.class)</code>
annotation on the class definition.  You can use the normal shadow implementation options, such as shadowing instance
methods using <code>@Implementation</code> or shadowing constructors using <code>public void __constructor__(...)</code>.</p>
<pre class="highlight java"><span class="nd">@Implements</span><span class="o">(</span><span class="n">Bitmap</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyShadowBitmap</span> <span class="o">{</span>
    <span class="nd">@RealObject</span> <span class="kd">private</span> <span class="n">Bitmap</span> <span class="n">realBitmap</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">bitmapQuality</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>

    <span class="nd">@Implementation</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">compress</span><span class="o">(</span><span class="n">Bitmap</span><span class="o">.</span><span class="na">CompressFormat</span> <span class="n">format</span><span class="o">,</span> <span class="kt">int</span> <span class="n">quality</span><span class="o">,</span> <span class="n">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">bitmapQuality</span> <span class="o">=</span> <span class="n">quality</span><span class="o">;</span>
      <span class="k">return</span> <span class="n">realBitmap</span><span class="o">.</span><span class="na">compress</span><span class="o">(</span><span class="n">format</span><span class="o">,</span> <span class="n">quality</span><span class="o">,</span> <span class="n">stream</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="n">getQuality</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">bitmapQuality</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>
<h2>Using a Custom Shadow</h2>

<p>Custom Shadows get hooked up to Robolectric using the @Config annotation on the test class or test method, using
the <code>shadows</code> array attribute.  To use the MyShadowBitmap class mentioned in the previous section, you would annotate
the test in question with <code>@Config(shadows={MyShadowBitmap.class})</code>, and to include multiple custom shadows:
<code>@Config(shadows={MyShadowBitmap.class, MyOtherCustomShadow.class})</code>.  This causes Robolectric to recognize and use
your custom shadow when executing code against the class you shadowed.</p>

<p>However, the <code>Robolectric.shadowOf()</code> method will not work with custom shadows, as it has to be implemented in
Robolectric for each shadow class.  You can instead use <code>Robolectric.shadowOf_()</code> and cast the return value to the
custom Shadow class you implemented.</p>

<p>Also, if you choose to shadow an Android class that already is shadowed in Robolectric, you will replace the
Robolectric shadow.  You could try inheriting from the Robolectric shadow if you still need the base shadow
functionality.</p>

        </div>
    </div>
</body>
</html>